「魔板」线段树 2



这是一道模板题？

idea：[$\color{red}\mathsf{Juan\_feng}$](https://www.luogu.org/space/show?uid=66965)

思路：[$\color{red}\mathsf{Juan\_feng}$](https://www.luogu.org/space/show?uid=66965)

std：[$\color{red}\mathsf{rehtorbegnaro}$](https://www.luogu.org/space/show?uid=63352)

题面：[$\color{red}\mathsf{rehtorbegnaro}$](https://www.luogu.org/space/show?uid=63352)

数据：[$\color{red}\mathsf{rehtorbegnaro}$](https://www.luogu.org/space/show?uid=63352)

[之前的故事](https://www.luogu.org/problemnew/show/T62117)

前排提醒，本题略卡时间+卡空间。不过如果有用线段树卡过去的请私信出题人蟹蟹。



loli最终还是搞了一场搜索测试。

然而，翻开试卷，Challestend震惊的发现了一道线段树的模板题。考完以后，Challestend想把这道题抄过来。然而ta视力低下，记忆力极差，以至于ta忘记了原题的时空限制。于是ta就随便编了一个上去。



第一行包含三个整数$N$、$M$、$P$，分别表示该数列数字的个数、操作的总个数和模数。

第二行包含$N$个用空格分隔的整数，其中第$i$个数字表示数列第$i$项的初始值$a_{i}$。

接下来$M$行每行包含$3$或$4$个整数，表示一个操作，具体如下：

操作1：`1 x y k`，含义：将区间$[x,y]$内每个数加上$k$；

操作2：`2 x y k`，含义：将区间$[x,y]$内每个数乘上$k$；

操作3：`3 x y k`，含义：输出区间$[x,y]$内每个数的和与$k$的乘积对$P$取模所得的结果。



对于每一个操作$3$，输出一行包含一个整数。



__数据范围与约定__

| 子任务编号 | 测试点编号 | 分值 | $N$ | $M$ | $P$ | 时间限制 | 空间限制 |
| :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: |
| $1$ | $1$ | $1$ | $=1000$ | $=1000$ | $=998244353$ | $900\text{ms}$ | $128\text{MB}$ |
| $1$ | $2$ | $1$ | $=1000$ | $=1000$ | $=998244353$ | $900\text{ms}$ | $128\text{MB}$ |
| $1$ | $3$ | $1$ | $=1000$ | $=1000$ | $=998244353$ | $900\text{ms}$ | $128\text{MB}$ |
| $2$ | $4$ | $3$ | $=10^{5}$ | $=10^{5}$ | $=998244353$ | $900\text{ms}$ | $128\text{MB}$ |
| $2$ | $5$ | $3$ | $=10^{5}$ | $=10^{5}$ | $=998244353$ | $900\text{ms}$ | $128\text{MB}$ |
| $3$ | $6$ | $10$ | $=10^{5}$ | $=10^{5}$ | $=998244353$ | $900\text{ms}$ | $1.5\text{MB}$ |
| $3$ | $7$ | $10$ | $=10^{5}$ | $=10^{5}$ | $=998244353$ | $900\text{ms}$ | $1.5\text{MB}$ |
| $3$ | $8$ | $10$ | $=10^{5}$ | $=10^{5}$ | $=998244353$ | $900\text{ms}$ | $1.5\text{MB}$ |
| $3$ | $9$ | $10$ | $=10^{5}$ | $=10^{5}$ | $=998244353$ | $900\text{ms}$ | $1.5\text{MB}$ |
| $3$ | $10$ | $10$ | $=10^{5}$ | $=10^{5}$ | $=998244353$ | $900\text{ms}$ | $1.5\text{MB}$ |
| $4$ | $11$ | $10$ | $=10^{5}$ | $=10^{5}$ | $=223092870$ | $900\text{ms}$ | $1.5\text{MB}$ |
| $4$ | $12$ | $10$ | $=10^{5}$ | $=10^{5}$ | $=223092870$ | $900\text{ms}$ | $1.5\text{MB}$ |
| $4$ | $13$ | $10$ | $=10^{5}$ | $=2\times 10^{6}$ | $=223092870$ | $3000\text{ms}$ | $1.5\text{MB}$ |
| $4$ | $14$ | $11$ | $=10^{5}$ | $=2\times 10^{6}$ | $=223092870$ | $2500\text{ms}$ | $1.5\text{MB}$ |

以及，对于全部的测试数据，$0\leqslant a_{i},k\lt 998244353$。

特殊地，对于测试点$13$、$14$，保证存在大量操作满足$x=y$。

每个子任务需AC所有测试点才算AC。无论是否AC，子任务时间取测试点的时间总和，空间取最后一个测试点的空间。

只要您信念坚定，相信自己的做法没有错，然后大喊一声「I won't MLE!」，您就能AC了。